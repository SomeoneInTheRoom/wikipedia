function renderCard(a) {
  seenIds.add(a.pageid ?? a.id);
  const card = document.createElement("div");
  card.className = "card";

  if (a.thumbnail?.source) {
    const img = document.createElement("img");
    img.src = a.thumbnail.source;
    img.alt = a.title;
    card.appendChild(img);
  }

  const c = document.createElement("div"); c.className = "content";
  const h = document.createElement("h2"); h.className = "title"; h.textContent = a.title; c.appendChild(h);
  const p = document.createElement("p"); p.className = "extract"; p.textContent = a.extract || ""; c.appendChild(p);

  // link row
  const link = document.createElement("a");
  link.className = "link";
  link.href = a.fullurl || a.content_urls?.desktop?.page || "#";
  link.target = "_blank"; link.rel = "noopener";
  link.textContent = "Read on Wikipedia â†’";
  c.appendChild(link);

  // actions row (visible button)
  const actions = document.createElement("div");
  actions.className = "actions";
  const copyBtn = document.createElement("button");
  copyBtn.textContent = "Copy chat prompt";
  copyBtn.onclick = async () => {
    const prompt = buildChatPrompt(a, activeTopic);
    try {
      await navigator.clipboard.writeText(prompt);
      showToast("Chat prompt copied");
    } catch {
      // fallback: open a prompt window if clipboard is blocked
      window.prompt("Copy this prompt:", prompt);
    }
  };
  actions.appendChild(copyBtn);
  c.appendChild(actions);

  card.appendChild(c);

  // Right-click anywhere on the card to copy the prompt
  card.addEventListener("contextmenu", async (ev) => {
    ev.preventDefault();
    const prompt = buildChatPrompt(a, activeTopic);
    try {
      await navigator.clipboard.writeText(prompt);
      showToast("Chat prompt copied");
    } catch {
      window.prompt("Copy this prompt:", prompt);
    }
  });

  feed.insertBefore(card, feed.firstChild);
}
